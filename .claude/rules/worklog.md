# Worklog Management Rules

## Task Completion Logging (MANDATORY)

**在完成任何任务后，MUST 生成工作日志并写入 worklog 目录。**

---

## 日志生成规则

### 1. 何时生成日志

以下情况**必须**生成 worklog 日志：

- ✅ 完成功能开发（新功能、bug 修复、重构）
- ✅ 完成架构决策或重要技术决策
- ✅ 完成模块实现
- ✅ 完成重要的配置或环境变更
- ✅ 完成文档编写或更新
- ✅ 完成测试编写或修复
- ✅ 解决复杂问题或 troubleshooting

**不需要**生成日志的情况：
- ❌ 简单的代码格式化
- ❌ 微小的文档修正（拼写错误等）
- ❌ 纯信息查询（无代码变更）

---

### 2. 日志文件命名规则

**格式:** `YYYYMMDD_HHMM_{task_name}.md`

**命名规范:**
- 日期时间：精确到分钟，使用 24 小时制
- 任务名称：使用 snake_case（小写字母和下划线）
- 任务名称：简洁描述核心任务内容（2-5 个单词）
- 文件扩展名：`.md`

**示例:**
```bash
20260203_1435_migrate_arch_to_doc.md           # 迁移架构文档
20260203_1520_add_worklog_rule.md              # 添加 worklog 规则
20260203_1630_implement_encryption_module.md    # 实现加密模块
20260203_2145_fix_ios_build_error.md           # 修复 iOS 构建错误
20260204_0930_setup_drift_database.md          # 设置 Drift 数据库
```

---

### 3. 日志文件内容结构

每个日志文件应包含以下标准章节：

```markdown
# {任务标题}

**日期:** YYYY-MM-DD
**时间:** HH:MM
**任务类型:** [功能开发|Bug修复|重构|架构决策|文档|测试|配置]
**状态:** [已完成|部分完成|待后续]
**相关模块:** [MOD-XXX] {模块名称}

---

## 任务概述

简要描述本次任务的目标和背景（2-3 句话）。

---

## 完成的工作

### 1. 主要变更
- 详细列出完成的工作内容
- 使用 bullet points
- 包含关键文件路径

### 2. 技术决策
- 如有重要技术决策，说明决策内容和理由
- 说明考虑过的备选方案

### 3. 代码变更统计
- 修改的文件数量
- 添加/删除的代码行数
- 涉及的主要文件路径

---

## 遇到的问题与解决方案

### 问题 1: {问题描述}
**症状:** ...
**原因:** ...
**解决方案:** ...

### 问题 2: {问题描述}
...

---

## 测试验证

- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] 手动测试验证
- [ ] 代码审查完成
- [ ] 文档已更新

---

## Git 提交记录

```bash
Commit: {commit_hash}
Author: {author_name}
Date: {commit_date}

{commit_message}
```

---

## 后续工作

- [ ] 待完成的任务 1
- [ ] 待完成的任务 2
- [ ] 需要跟进的问题

---

## 参考资源

- [相关文档链接]
- [相关 Issue/PR 链接]
- [参考资料链接]

---

**创建时间:** {YYYY-MM-DD HH:MM}
**作者:** Claude Sonnet 4.5
```

---

### 4. 日志生成工作流程

当完成任务时，**必须**按照以下步骤生成日志：

#### Step 1: 确认任务完成
- 确保所有代码变更已提交
- 确保测试已通过
- 确保文档已更新

#### Step 2: 生成日志文件名
```bash
# 获取当前日期时间
DATE=$(date +%Y%m%d_%H%M)

# 确定任务名称（示例）
TASK="migrate_worklog_to_doc"

# 组合文件名
FILENAME="${DATE}_${TASK}.md"
```

#### Step 3: 编写日志内容
按照上述模板结构，填写详细的工作日志。

#### Step 4: 保存到 worklog 目录
```bash
# 保存到正确的位置
docs/worklog/${FILENAME}
```

#### Step 5: 验证日志文件
```bash
# 检查文件是否创建成功
ls -la docs/worklog/${FILENAME}

# 快速查看文件内容
head -30 docs/worklog/${FILENAME}
```

---

## Claude 执行规范

当任务完成时，Claude **必须**：

1. ✅ **自动识别需要生成日志**
   - 在完成任务后，判断是否属于需要记录的任务类型
   - 不需要用户明确要求即主动生成日志

2. ✅ **生成规范的文件名**
   - 使用当前日期时间
   - 提炼核心任务名称（简洁、准确）
   - 遵循 snake_case 命名规范

3. ✅ **编写完整的日志内容**
   - 包含所有标准章节
   - 详细记录工作内容和决策
   - 列出遇到的问题和解决方案
   - 包含测试验证清单
   - 记录 git 提交信息

4. ✅ **保存到正确位置**
   - 文件路径：`docs/worklog/{filename}.md`
   - 验证文件创建成功

5. ✅ **在响应中告知用户**
   - 明确告知用户已生成工作日志
   - 提供日志文件路径
   - 简要说明日志内容

---

## 日志文件管理

### 目录结构

```
doc/worklog/
├── PROJECT_DEVELOPMENT_PLAN.md    # 项目开发计划（主文档）
├── 20260203_1435_task_name.md     # 每日任务日志
├── 20260203_1520_task_name.md
├── 20260204_0930_task_name.md
└── ...
```

### 日志归档策略

- **保留所有日志文件**，不删除历史记录
- 日志文件按时间顺序自然排列
- 如需查找特定任务，使用 `grep` 或文件名搜索

### 搜索日志示例

```bash
# 按日期查找
ls docs/worklog/20260203_*.md

# 按任务名称查找
ls docs/worklog/*_migration_*.md

# 搜索日志内容
grep -r "encryption" docs/worklog/
```

---

## 禁止操作

❌ **禁止跳过日志生成** - 完成任务必须生成日志
❌ **禁止使用不规范的文件名** - 必须遵循命名规则
❌ **禁止生成空日志或敷衍日志** - 必须包含完整内容
❌ **禁止删除或修改历史日志** - 只能追加，不能修改
❌ **禁止在 worklog 外的位置创建日志** - 统一存放在 doc/worklog/

---

## 日志质量标准

一个高质量的工作日志应该：

✅ **完整性**
- 包含所有标准章节
- 记录所有重要决策和变更
- 包含问题和解决方案

✅ **准确性**
- 信息真实可靠
- 时间戳准确
- Git 提交记录准确

✅ **可读性**
- 结构清晰
- 语言简洁
- 重点突出

✅ **可追溯性**
- 提供文件路径
- 提供 commit hash
- 提供相关文档链接

---

## 示例日志

参考 `docs/worklog/20260203_1435_migrate_arch_to_doc.md` 作为日志模板示例。

---

**规则版本:** 1.0
**创建日期:** 2026-02-03
**适用范围:** 所有任务完成后的工作日志生成
